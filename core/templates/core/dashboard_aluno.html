{% extends 'core/base.html' %}
{% load static %}

{% block content %}

<style>
    /* Esconde a barra lateral e força tela cheia */
    #sidebar-wrapper, .sidebar, nav.col-md-3 { 
        display: none !important; 
    }
    
    main, .col-md-9, .ms-sm-auto { 
        margin-left: 0 !important; 
        width: 100% !important; 
        padding: 0 !important;
        max-width: 100% !important;
    }

    /* Fundo estilo App */
    body { background-color: #f0f2f5; }

    /* Animação do Botão de Boletim */
    .pulse-button {
        animation: pulse 2s infinite;
    }
    @keyframes pulse {
        0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255, 193, 7, 0.7); }
        70% { transform: scale(1.05); box-shadow: 0 0 0 10px rgba(255, 193, 7, 0); }
        100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255, 193, 7, 0); }
    }
</style>

<div class="container py-3" style="max-width: 600px;"> 
    
    <div class="d-flex align-items-center justify-content-between mb-4 px-2">
        <div class="d-flex align-items-center">
            <div class="bg-white text-primary rounded-circle shadow-sm d-flex align-items-center justify-content-center fw-bold fs-4 me-3" style="width: 50px; height: 50px;">
                {{ aluno.nome_completo.0 }}
            </div>
            <div>
                <h5 class="fw-bold mb-0 text-dark">{{ aluno.nome_completo.split.0 }}</h5>
                <small class="text-muted">ID: {{ aluno.id }}</small>
            </div>
        </div>
        <a href="{% url 'logout' %}" class="btn btn-light btn-sm rounded-pill shadow-sm text-danger">
            <i class="bi bi-box-arrow-right"></i> Sair
        </a>
    </div>

    <div class="card bg-primary text-white border-0 shadow-lg rounded-4 mb-4 position-relative overflow-hidden">
        <div style="position: absolute; right: -20px; top: -20px; font-size: 8rem; opacity: 0.1;"><i class="bi bi-trophy-fill"></i></div>
        
        <div class="card-body p-4 text-center position-relative z-1">
            <p class="mb-0 opacity-75 fw-bold text-uppercase small">Média Geral de Proficiência</p>
            <h1 class="display-3 fw-bold mb-3">{{ media_geral|floatformat:0 }}%</h1>
            
            <div class="mt-2">
                <a href="{% url 'gerar_boletim_pdf' aluno.id %}" class="btn btn-warning text-dark fw-bold rounded-pill px-5 py-3 shadow-lg pulse-button text-decoration-none">
                    <i class="bi bi-cloud-arrow-down-fill me-2"></i> BAIXAR BOLETIM
                </a>
            </div>
        </div>
    </div>

    {% if pontos_fortes %}
    <h6 class="fw-bold px-2 mb-3 text-secondary"><i class="bi bi-lightning-charge-fill text-warning me-1"></i> MEUS PONTOS FORTES</h6>
    <div class="row g-2 mb-4">
        {% for p in pontos_fortes %}
        <div class="col-12">
            <div class="card border-0 shadow-sm rounded-4" style="border-left: 5px solid #198754 !important;">
                <div class="card-body p-3 d-flex align-items-center justify-content-between">
                    <div>
                        <span class="badge bg-success mb-1">{{ p.codigo }}</span>
                        <p class="mb-0 small text-muted lh-sm">{{ p.descricao|truncatechars:40 }}</p>
                    </div>
                    <div class="text-end ms-2">
                        <span class="fw-bold text-success">{{ p.porcentagem|floatformat:0 }}%</span>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% endif %}

    {% if pontos_atencao %}
    <h6 class="fw-bold px-2 mb-3 text-secondary"><i class="bi bi-cone-striped text-danger me-1"></i> PRECISO REVISAR</h6>
    <div class="row g-2 mb-4">
        {% for p in pontos_atencao %}
        <div class="col-12">
            <div class="card border-0 shadow-sm rounded-4" style="border-left: 5px solid #dc3545 !important;">
                <div class="card-body p-3 d-flex align-items-center justify-content-between">
                    <div>
                        <span class="badge bg-danger mb-1">{{ p.codigo }}</span>
                        <p class="mb-0 small text-muted lh-sm">{{ p.descricao|truncatechars:40 }}</p>
                    </div>
                    <div class="text-end ms-2">
                        <span class="fw-bold text-danger">{{ p.porcentagem|floatformat:0 }}%</span>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <h6 class="fw-bold px-2 mb-3 text-secondary">AVALIAÇÕES RECENTES</h6>
    <div class="d-grid gap-3 mb-5">
        {% for res in resultados %}
        <div class="card border-0 shadow-sm rounded-4">
            <div class="card-body p-3">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="fw-bold mb-0 text-dark">{{ res.avaliacao.titulo }}</h6>
                        <small class="text-muted" style="font-size: 0.8rem;">
                            {{ res.avaliacao.disciplina.nome }} • {{ res.avaliacao.data_aplicacao|date:"d/m" }}
                        </small>
                    </div>
                    <div class="text-end">
                        <span class="badge rounded-pill {% if res.percentual >= 60 %}bg-success{% else %}bg-danger{% endif %}">
                            {{ res.percentual|floatformat:0 }}%
                        </span>
                    </div>
                </div>
                
                <div class="mt-3 pt-3 border-top d-flex justify-content-between align-items-center">
                    <span class="small text-muted">
                        Acertou <strong>{{ res.acertos }}</strong> de {{ res.total_questoes }} questões
                    </span>
                    {% if res.status == 'ADQ' %} <i class="bi bi-emoji-smile-fill text-success fs-5"></i>
                    {% elif res.status == 'INT' %} <i class="bi bi-emoji-neutral-fill text-warning fs-5"></i>
                    {% else %} <i class="bi bi-emoji-frown-fill text-danger fs-5"></i>
                    {% endif %}
                </div>
            </div>
        </div>
        {% empty %}
        <div class="text-center py-5 opacity-50">
            <i class="bi bi-clipboard-x display-1"></i>
            <p class="mt-3">Nenhuma avaliação encontrada.</p>
        </div>
        {% endfor %}
    </div>

    <div class="text-center pb-4">
        <a href="{% url 'central_ajuda' %}" class="text-decoration-none text-muted small fw-bold">
            <i class="bi bi-question-circle"></i> Precisa de Ajuda?
        </a>
    </div>

</div>
{% endblock %}